!function(t){"use strict";const e={shouldNormalizeDom:!0,mainEventHandler:(t,e,n)=>("function"==typeof t?t(e):Array.isArray(t)&&(t=function(t){t=t.slice();const e=[];let n;for(;(n=t[0])&&"string"==typeof n;)e.push(t.shift());return{modifiers:e,data:t}}(t).data)[0](t[1],e),!1)};class n{constructor(t,e){this.key=t,this.child=e}mount(t,e){this.parentEl=t,this.child.mount(t,e)}moveBefore(t,e){this.child.moveBefore(t?t.child:null,e)}patch(t,e){if(this===t)return;let n=this.child,o=t.child;this.key===t.key?n.patch(o,e):(o.mount(this.parentEl,n.firstNode()),e&&n.beforeRemove(),n.remove(),this.child=o,this.key=t.key)}beforeRemove(){this.child.beforeRemove()}remove(){this.child.remove()}firstNode(){return this.child.firstNode()}toString(){return this.child.toString()}}const{setAttribute:o,removeAttribute:r}=Element.prototype,i=DOMTokenList.prototype,l=i.add,s=i.remove,c=Array.isArray,{split:a,trim:h}=String.prototype,f=/\s+/;function d(t,e){switch(e){case!1:case void 0:r.call(this,t);break;case!0:o.call(this,t,"");break;default:o.call(this,t,e)}}function u(t){return function(e){d.call(this,t,e)}}function p(t){if(c(t))d.call(this,t[0],t[1]);else for(let e in t)d.call(this,e,t[e])}function m(t,e){if(c(t)){const n=t[0],o=t[1];if(n===e[0]){if(o===e[1])return;d.call(this,n,o)}else r.call(this,e[0]),d.call(this,n,o)}else{for(let n in e)n in t||r.call(this,n);for(let n in t){const o=t[n];o!==e[n]&&d.call(this,n,o)}}}function x(t){const e={};switch(typeof t){case"string":const n=h.call(t);if(!n)return{};let o=a.call(n,f);for(let t=0,n=o.length;t<n;t++)e[o[t]]=!0;return e;case"object":for(let n in t){const o=t[n];if(o){const t=a.call(n,f);for(let n of t)e[n]=o}}return e;case"undefined":return{};case"number":return{[t]:!0};default:return{[t]:!0}}}function v(t){t=""===t?{}:x(t);const e=this.classList;for(let n in t)l.call(e,n)}function g(t,e){e=""===e?{}:x(e),t=""===t?{}:x(t);const n=this.classList;for(let o in e)o in t||s.call(n,o);for(let o in t)o in e||l.call(n,o)}function N(t){return function(e){this[t]=e}}function b(t,e){switch(t){case"input":return"checked"===e||"indeterminate"===e||"value"===e||"readonly"===e||"disabled"===e;case"option":return"selected"===e||"disabled"===e;case"textarea":return"value"===e||"readonly"===e||"disabled"===e;case"select":return"value"===e||"disabled"===e;case"button":case"optgroup":return"disabled"===e}return!1}function y(t){const n=t.split(".")[0],o=t.includes(".capture");return t.includes(".synthetic")?function(t,n=!1){let o=`__event__synthetic_${t}`;n&&(o=`${o}_capture`);!function(t,n,o=!1){if(C[n])return;document.addEventListener(t,(t=>function(t,n){let o=n.target;for(;null!==o;){const r=o[t];if(r)for(const t of Object.values(r)){if(e.mainEventHandler(t,n,o))return}o=o.parentNode}}(n,t)),{capture:o}),C[n]=!0}(t,o,n);const r=I++;function i(t){const e=this[o]||{};e[r]=t,this[o]=e}return{setup:i,update:i}}(n,o):function(t,n=!1){let o=`__event__${t}_${E++}`;n&&(o=`${o}_capture`);function r(t){const n=t.currentTarget;if(!n||!document.contains(n))return;const r=n[o];r&&e.mainEventHandler(r,t,n)}function i(e){this[o]=e,this.addEventListener(t,r,{capture:n})}function l(t){this[o]=t}return{setup:i,update:l}}(n,o)}let E=1;let I=1;const C={};const D=Node.prototype,k=D.insertBefore,R=(T=D,O="textContent",Object.getOwnPropertyDescriptor(T,O)).set;var T,O;const S=D.removeChild;class w{constructor(t){this.children=t}mount(t,e){const n=this.children,o=n.length,r=new Array(o);for(let i=0;i<o;i++){let o=n[i];if(o)o.mount(t,e);else{const n=document.createTextNode("");r[i]=n,k.call(t,n,e)}}this.anchors=r,this.parentEl=t}moveBefore(t,e){if(t){const n=t.children[0];e=(n?n.firstNode():t.anchors[0])||null}const n=this.children,o=this.parentEl,r=this.anchors;for(let t=0,i=n.length;t<i;t++){let i=n[t];if(i)i.moveBefore(null,e);else{const n=r[t];k.call(o,n,e)}}}patch(t,e){if(this===t)return;const n=this.children,o=t.children,r=this.anchors,i=this.parentEl;for(let t=0,l=n.length;t<l;t++){const l=n[t],s=o[t];if(l)if(s)l.patch(s,e);else{const o=l.firstNode(),s=document.createTextNode("");r[t]=s,k.call(i,s,o),e&&l.beforeRemove(),l.remove(),n[t]=void 0}else if(s){n[t]=s;const e=r[t];s.mount(i,e),S.call(i,e)}}}beforeRemove(){const t=this.children;for(let e=0,n=t.length;e<n;e++){const n=t[e];n&&n.beforeRemove()}}remove(){const t=this.parentEl;if(this.isOnlyChild)R.call(t,"");else{const e=this.children,n=this.anchors;for(let o=0,r=e.length;o<r;o++){const r=e[o];r?r.remove():S.call(t,n[o])}}}firstNode(){const t=this.children[0];return t?t.firstNode():this.anchors[0]}toString(){return this.children.map((t=>t?t.toString():"")).join("")}}const _=Node.prototype,B=CharacterData.prototype,L=_.insertBefore,A=((t,e)=>Object.getOwnPropertyDescriptor(t,e))(B,"data").set,M=_.removeChild;class j{constructor(t){this.text=t}mountNode(t,e,n){this.parentEl=e,L.call(e,t,n),this.el=t}moveBefore(t,e){const n=t?t.el:e;L.call(this.parentEl,this.el,n)}beforeRemove(){}remove(){M.call(this.parentEl,this.el)}firstNode(){return this.el}toString(){return this.text}}class H extends j{mount(t,e){this.mountNode(document.createTextNode($(this.text)),t,e)}patch(t){const e=t.text;this.text!==e&&(A.call(this.el,$(e)),this.text=e)}}class P extends j{mount(t,e){this.mountNode(document.createComment($(this.text)),t,e)}patch(){}}function $(t){switch(typeof t){case"string":return t;case"number":return String(t);case"boolean":return t?"true":"false";default:return t||""}}const W=(t,e)=>Object.getOwnPropertyDescriptor(t,e),V=Node.prototype,X=Element.prototype,z=W(CharacterData.prototype,"data").set,F=W(V,"firstChild").get,K=W(V,"nextSibling").get,q=()=>{},G={};function J(t){if(t.nodeType!==Node.TEXT_NODE||/\S/.test(t.textContent)){if(t.nodeType!==Node.ELEMENT_NODE||"pre"!==t.tagName)for(let e=t.childNodes.length-1;e>=0;--e)J(t.childNodes.item(e))}else t.remove()}function Q(t,e=null,n=null){switch(t.nodeType){case Node.ELEMENT_NODE:{let o=n&&n.currentNS;const r=t.tagName;let i;const l=[];if(r.startsWith("block-text-")){const t=parseInt(r.slice(11),10);l.push({type:"text",idx:t}),i=document.createTextNode("")}if(r.startsWith("block-child-")){n.isRef||U(n);const t=parseInt(r.slice(12),10);l.push({type:"child",idx:t}),i=document.createTextNode("")}const s=t.attributes,c=s.getNamedItem("block-ns");if(c&&(s.removeNamedItem("block-ns"),o=c.value),i||(i=o?document.createElementNS(o,r):document.createElement(r)),i instanceof Element)for(let t=0;t<s.length;t++){const e=s[t].name,n=s[t].value;if(e.startsWith("block-handler-")){const t=parseInt(e.slice(14),10);l.push({type:"handler",idx:t,event:n})}else if(e.startsWith("block-attribute-")){const t=parseInt(e.slice(16),10);l.push({type:"attribute",idx:t,name:n,tag:r})}else"block-attributes"===e?l.push({type:"attributes",idx:parseInt(n,10)}):"block-ref"===e?l.push({type:"ref",idx:parseInt(n,10)}):i.setAttribute(s[t].name,n)}const a={parent:e,firstChild:null,nextSibling:null,el:i,info:l,refN:0,currentNS:o};if(t.firstChild){const e=t.childNodes[0];if(1===t.childNodes.length&&e.nodeType===Node.ELEMENT_NODE&&e.tagName.startsWith("block-child-")){const t=e.tagName,n=parseInt(t.slice(12),10);l.push({idx:n,type:"child",isOnlyChild:!0})}else{a.firstChild=Q(t.firstChild,a,a),i.appendChild(a.firstChild.el);let e=t.firstChild,n=a.firstChild;for(;e=e.nextSibling;)n.nextSibling=Q(e,n,a),i.appendChild(n.nextSibling.el),n=n.nextSibling}}return a.info.length&&U(a),a}case Node.TEXT_NODE:case Node.COMMENT_NODE:return{parent:e,firstChild:null,nextSibling:null,el:t.nodeType===Node.TEXT_NODE?document.createTextNode(t.textContent):document.createComment(t.textContent),info:[],refN:0,currentNS:null}}throw new Error("boom")}function U(t){t.isRef=!0;do{t.refN++}while(t=t.parent)}function Y(t){let e=t.parent;for(;e&&e.nextSibling===t;)t=e,e=e.parent;return e}function Z(t,e,n){if(!e){e={collectors:[],locations:[],children:new Array(t.info.filter((t=>"child"===t.type)).length),cbRefs:[],refN:t.refN,refList:[]},n=0}if(t.refN){const o=n,r=t.isRef,i=t.firstChild?t.firstChild.refN:0,l=t.nextSibling?t.nextSibling.refN:0;if(r){for(let e of t.info)e.refIdx=o;t.refIdx=o,function(t,e){for(let n of e.info)switch(n.type){case"text":t.locations.push({idx:n.idx,refIdx:n.refIdx,setData:tt,updateData:tt});break;case"child":n.isOnlyChild?t.children[n.idx]={parentRefIdx:n.refIdx,isOnlyChild:!0}:t.children[n.idx]={parentRefIdx:Y(e).refIdx,afterRefIdx:n.refIdx};break;case"attribute":{const e=n.refIdx;let o,r;if(b(n.tag,n.name)){const t=N(n.name);r=t,o=t}else"class"===n.name?(r=v,o=g):(r=u(n.name),o=r);t.locations.push({idx:n.idx,refIdx:e,setData:r,updateData:o});break}case"attributes":t.locations.push({idx:n.idx,refIdx:n.refIdx,setData:p,updateData:m});break;case"handler":{const{setup:e,update:o}=y(n.event);t.locations.push({idx:n.idx,refIdx:n.refIdx,setData:e,updateData:o});break}case"ref":const o=t.cbRefs.push(n.idx)-1;t.locations.push({idx:n.idx,refIdx:n.refIdx,setData:et(o,t.refList),updateData:q})}}(e,t),n++}if(l){const r=n+i;e.collectors.push({idx:r,prevIdx:o,getVal:K}),Z(t.nextSibling,e,r)}i&&(e.collectors.push({idx:n,prevIdx:o,getVal:F}),Z(t.firstChild,e,n))}return e}function tt(t){z.call(this,$(t))}function et(t,e){return function(n){e[e.length-1][t]=()=>n(this)}}const nt=Node.prototype,ot=nt.insertBefore,rt=nt.appendChild,it=nt.removeChild,lt=((t,e)=>Object.getOwnPropertyDescriptor(t,e))(nt,"textContent").set;class st{constructor(t){this.children=t}mount(t,e){const n=this.children,o=document.createTextNode("");this.anchor=o,ot.call(t,o,e);const r=n.length;if(r){const e=n[0].mount;for(let i=0;i<r;i++)e.call(n[i],t,o)}this.parentEl=t}moveBefore(t,e){if(t){const n=t.children[0];e=(n?n.firstNode():t.anchor)||null}const n=this.children;for(let t=0,o=n.length;t<o;t++)n[t].moveBefore(null,e);this.parentEl.insertBefore(this.anchor,e)}patch(t,e){if(this===t)return;const n=this.children,o=t.children;if(0===o.length&&0===n.length)return;this.children=o;const r=o[0]||n[0],{mount:i,patch:l,remove:s,beforeRemove:c,moveBefore:a,firstNode:h}=r,f=this.anchor,d=this.isOnlyChild,u=this.parentEl;if(0===o.length&&d){if(e)for(let t=0,e=n.length;t<e;t++)c.call(n[t]);return lt.call(u,""),void rt.call(u,f)}let p,m=0,x=0,v=n[0],g=o[0],N=n.length-1,b=o.length-1,y=n[N],E=o[b];for(;m<=N&&x<=b;){if(null===v){v=n[++m];continue}if(null===y){y=n[--N];continue}let t=v.key,r=g.key;if(t===r){l.call(v,g,e),o[x]=v,v=n[++m],g=o[++x];continue}let s=y.key,c=E.key;if(s===c){l.call(y,E,e),o[b]=y,y=n[--N],E=o[--b];continue}if(t===c){l.call(v,E,e),o[b]=v;const t=o[b+1];a.call(v,t,f),v=n[++m],E=o[--b];continue}if(s===r){l.call(y,g,e),o[x]=y;const t=n[m];a.call(y,t,f),y=n[--N],g=o[++x];continue}p=p||ct(n,m,N);let d=p[r];if(void 0===d)i.call(g,u,h.call(v)||null);else{const t=n[d];a.call(t,v,null),l.call(t,g,e),o[x]=t,n[d]=null}g=o[++x]}if(m<=N||x<=b)if(m>N){const t=o[b+1],e=t?h.call(t)||null:f;for(let t=x;t<=b;t++)i.call(o[t],u,e)}else for(let t=m;t<=N;t++){let o=n[t];o&&(e&&c.call(o),s.call(o))}}beforeRemove(){const t=this.children,e=t.length;if(e){const n=t[0].beforeRemove;for(let o=0;o<e;o++)n.call(t[o])}}remove(){const{parentEl:t,anchor:e}=this;if(this.isOnlyChild)lt.call(t,"");else{const n=this.children,o=n.length;if(o){const t=n[0].remove;for(let e=0;e<o;e++)t.call(n[e])}it.call(t,e)}}firstNode(){const t=this.children[0];return t?t.firstNode():void 0}toString(){return this.children.map((t=>t.toString())).join("")}}function ct(t,e,n){let o={};for(let r=e;r<=n;r++)o[t[r].key]=r;return o}const at=Node.prototype,ht=at.insertBefore,ft=at.removeChild;class dt{constructor(t){this.content=[],this.html=t}mount(t,e){this.parentEl=t;const n=document.createElement("template");n.innerHTML=this.html,this.content=[...n.content.childNodes];for(let n of this.content)ht.call(t,n,e);if(!this.content.length){const n=document.createTextNode("");this.content.push(n),ht.call(t,n,e)}}moveBefore(t,e){const n=t?t.content[0]:e,o=this.parentEl;for(let t of this.content)ht.call(o,t,n)}patch(t){if(this===t)return;const e=t.html;if(this.html!==e){const n=this.parentEl,o=this.content[0],r=document.createElement("template");r.innerHTML=e;const i=[...r.content.childNodes];for(let t of i)ht.call(n,t,o);if(!i.length){const t=document.createTextNode("");i.push(t),ht.call(n,t,o)}this.remove(),this.content=i,this.html=t.html}}beforeRemove(){}remove(){const t=this.parentEl;for(let e of this.content)ft.call(t,e)}firstNode(){return this.content[0]}toString(){return this.html}}t.comment=function(t){return new P(t)},t.config=e,t.createBlock=function(t){if(t in G)return G[t];const n=(new DOMParser).parseFromString(`<t>${t.trim()}</t>`,"text/xml").firstChild.firstChild;e.shouldNormalizeDom&&J(n);const o=Q(n),r=Z(o),i=function(t,e){let n=function(t,e){const{refN:n,collectors:o,children:r}=e,i=o.length;e.locations.sort(((t,e)=>t.idx-e.idx));const l=e.locations.map((t=>({refIdx:t.refIdx,setData:t.setData,updateData:t.updateData}))),s=l.length,c=r.length,a=r,h=n>0,f=V.cloneNode,d=V.insertBefore,u=X.remove;class p{constructor(t){this.data=t}beforeRemove(){}remove(){u.call(this.el)}firstNode(){return this.el}moveBefore(t,e){const n=t?t.el:e;d.call(this.parentEl,this.el,n)}toString(){const t=document.createElement("div");return this.mount(t,null),t.innerHTML}mount(e,n){const o=f.call(t,!0);d.call(e,o,n),this.el=o,this.parentEl=e}patch(t,e){}}h&&(p.prototype.mount=function(e,r){const h=f.call(t,!0),u=new Array(n);this.refs=u,u[0]=h;for(let t=0;t<i;t++){const e=o[t];u[e.idx]=e.getVal.call(u[e.prevIdx])}if(s){const t=this.data;for(let e=0;e<s;e++){const n=l[e];n.setData.call(u[n.refIdx],t[e])}}if(d.call(e,h,r),c){const t=this.children;for(let e=0;e<c;e++){const n=t[e];if(n){const t=a[e],o=t.afterRefIdx?u[t.afterRefIdx]:null;n.isOnlyChild=t.isOnlyChild,n.mount(u[t.parentRefIdx],o)}}}this.el=h,this.parentEl=e},p.prototype.patch=function(t,e){if(this===t)return;const n=this.refs;if(s){const e=this.data,o=t.data;for(let t=0;t<s;t++){const r=e[t],i=o[t];if(r!==i){const e=l[t];e.updateData.call(n[e.refIdx],i,r)}}this.data=o}if(c){let o=this.children;const r=t.children;for(let t=0;t<c;t++){const i=o[t],l=r[t];if(i)l?i.patch(l,e):(e&&i.beforeRemove(),i.remove(),o[t]=void 0);else if(l){const e=a[t],r=e.afterRefIdx?n[e.afterRefIdx]:null;l.mount(n[e.parentRefIdx],r),o[t]=l}}}});return p}(t,e);if(e.cbRefs.length){const t=e.cbRefs,o=e.refList;let r=t.length;n=class extends n{mount(t,e){o.push(new Array(r)),super.mount(t,e);for(let t of o.pop())t()}remove(){super.remove();for(let e of t){(0,this.data[e])(null)}}}}if(e.children.length)return n=class extends n{constructor(t,e){super(t),this.children=e}},n.prototype.beforeRemove=w.prototype.beforeRemove,(t,e=[])=>new n(t,e);return t=>new n(t)}(o.el,r);return G[t]=i,i},t.html=function(t){return new dt(t)},t.list=function(t){return new st(t)},t.mount=function(t,e,n=null){t.mount(e,n)},t.multi=function(t){return new w(t)},t.patch=function(t,e,n=!1){t.patch(e,n)},t.remove=function(t,e=!1){e&&t.beforeRemove(),t.remove()},t.text=function(t){return new H(t)},t.toggler=function(t,e){return new n(t,e)},t.withKey=function(t,e){return t.key=e,t},Object.defineProperty(t,"__esModule",{value:!0})}(this.blockdom=this.blockdom||{});
